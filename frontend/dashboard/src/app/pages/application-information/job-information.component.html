<div id="main-container">
  <nz-content>
    <div nz-row>
      <nz-col nzSpan="24">
        <nz-breadcrumb>
          <nz-breadcrumb-item>
            <a [routerLink]="['../../']">Overview</a>
          </nz-breadcrumb-item>
          <nz-breadcrumb-item *ngIf="this.jobStarted">
            <a [routerLink]="['../../applications/processing-applications']">Processing Applications</a>
          </nz-breadcrumb-item>
          <nz-breadcrumb-item *ngIf="!this.jobStarted">
            <a [routerLink]="['../../applications/finished-applications']">Finished Applications</a>
          </nz-breadcrumb-item>
          <nz-breadcrumb-item>{{job?.name}}</nz-breadcrumb-item>
        </nz-breadcrumb>
      </nz-col>
    </div>
    <nz-row nzJustify="space-between" nzAlign="top" class="job-info-row">
      <nz-col nzSpan="24" class="container" id="job-description-view">
        <nz-descriptions id="job-description" nzBordered>
          <nz-descriptions-item nzTitle="Working Threads" nzSpan="2">{{job?.nthreads}}</nz-descriptions-item>
          <nz-descriptions-item nzTitle="Status" nzSpan="1"><nz-tag [nzColor]="this.jobStarted?'#2db7f5':'#cd201f'">{{this.jobStarted?"running":"stopped"}}</nz-tag></nz-descriptions-item>
<!--          <nz-descriptions-item nzTitle="CPU Utilization" nzSpan="2">{{"20%"}}</nz-descriptions-item>-->
<!--          <nz-descriptions-item nzTitle="RAM Utilization" nzSpan="1">{{"60%"}}</nz-descriptions-item>-->
          <nz-descriptions-item nzTitle="Number of Operators" nzSpan="2">{{job?.operators?.length}}</nz-descriptions-item>
<!--          <nz-descriptions-item nzTitle="Duration" nzSpan="1">{{job?.duration}}</nz-descriptions-item>-->
          <nz-descriptions-item nzTitle="Duration" nzSpan="1">{{runtimeDuration}} seconds</nz-descriptions-item>
          <nz-descriptions-item nzTitle="Create Time" nzSpan="2">{{job?.startTime}}</nz-descriptions-item>
          <nz-descriptions-item nzTitle="Operation" nzSpan="1">
            <button nz-button nzType="primary" [disabled]="this.jobStarted" style="margin-right: 20px" (click)="onStart()"><span nz-icon nzType="poweroff" nzTheme="outline"></span>Start</button>
            <button nz-button nzType="primary" [disabled]="!this.jobStarted" style="margin-right: 20px" (click)="onStop()"><span nz-icon nzType="stop" nzTheme="outline"></span>Stop</button>
          </nz-descriptions-item>
        </nz-descriptions>
      </nz-col>
      <!--    Information Showcase    -->
    </nz-row>
    <nz-row>
      <nz-col nzSpan="24" class="container" id="operator-list-view">
        <nz-collapse>
          <nz-collapse-panel [nzHeader]="operatorPanelHeader">
            <ng-template #operatorPanelHeader>
              <div>
                <span nz-icon nzType="area-chart" nzTheme="outline" style="margin-right: 2px;"></span> Operator Statistics
              </div>
            </ng-template>
            <nz-list nzItemLayout="horizontal">
              <nz-list-item *ngFor="let operator of job?.operators">
                <nz-list-item-meta>
                  <nz-list-item-meta-title>{{operator?.name}}</nz-list-item-meta-title>
                  <nz-list-item-meta-description>Number of instance: {{operator?.numOfInstances}}</nz-list-item-meta-description>
                </nz-list-item-meta>
                <nz-tag [nzColor]="'green'">throughput: {{operatorAccumulativeThroughput['sl']}} tuples/s</nz-tag>
                <nz-tag [nzColor]="'blue'">latency: {{operatorAccumulativeLatency['sl']}} ms</nz-tag>
              </nz-list-item>
            </nz-list>
          </nz-collapse-panel>
          <nz-collapse-panel [nzHeader]="topologyPanelHeader">
            <ng-template #topologyPanelHeader>
              <div>
                <span nz-icon nzType="apartment" nzTheme="outline"  style="margin-right: 2px;"></span> Operator Topology
              </div>
            </ng-template>
            <nz-graph
              nz-graph-zoom
              [nzGraphData]="nzOperatorGraphData"
              [nzAutoSize]="true"
              [nzRankDirection]="'LR'"
              (nzGraphInitialized)="onOperatorGraphInitialized($event)">
              <ng-container *nzGraphNode="let node">
                <foreignObject x="0" y="0" width="140px" height="80px">
                  <div class="operator-node" nz-popover
                       [nzPopoverContent]="'instance: ' + node.instance"
                       [nzPopoverTitle]="node.label"
                       nzPopoverPlacement="right">
                    <span>{{ node.label }}</span>
                  </div>
                </foreignObject>
              </ng-container>
            </nz-graph>
          </nz-collapse-panel>
        </nz-collapse>
      </nz-col>
    </nz-row>
    <nz-row nzJustify="space-between" nzAlign="top" class="job-info-row">
      <nz-col nzSpan="13" class="container  containerb">
        <!-- <nz-row nzJustify="space-between"> -->
          <!-- <form nz-form nzLayout="horizontal" style="width: 100%" [formGroup]="batchForm" (ngSubmit)="submitBatchStatisticForm()">
            <div nz-row nzGutter="24"> -->
              <!--Selector-->
              <!-- <nz-col nzSpan="14" class="selector_container">
                <nz-form-item>
                  <nz-form-label nzRequired nzFor="operator">Operator</nz-form-label>
                  <nz-form-control>
                    <nz-select nzAllowClear nzPlaceHolder="Operator" style="width: 100%" formControlName="operator">
                      <nz-option *ngFor="let operator of job?.operators" [nzLabel]="operator.name" [nzValue]="operator.name"></nz-option>
                    </nz-select>
                  </nz-form-control>
                </nz-form-item>
              </nz-col> -->
              <!-- <nz-col nzSpan="7" class="selector_container">
                <nz-form-item>
                  <nz-form-label nzRequired nzFor="batch">Batch</nz-form-label>
                  <nz-form-control>
                    <nz-select nzAllowClear nzPlaceHolder="Batch" style="width: 100%" formControlName="batch">
                      <nz-option *ngFor="let option of batchOptions" [nzLabel]="option.label" [nzValue]="option.value"></nz-option>
                    </nz-select>
                  </nz-form-control>
                </nz-form-item>
              </nz-col> -->
              <!-- <nz-col nzSpan="2" class="selector_container">
                <nz-form-item>
                  <button nz-button nzType="primary"><span nz-icon nzType="search" nzTheme="outline"></span></button>
                </nz-form-item>
              </nz-col> -->
            <!-- </div>
          </form> -->
        <!-- </nz-row> -->
        <!-- <nz-tabset> -->
          <!-- <iframe src="http://127.0.0.1:8265/#/actors/180a5ccf398a5f14d3fd4ceb01000000" class="full-iframe"></iframe> -->
          <iframe #actorsIframe src="http://127.0.0.1:8265/#/actors" class="full-iframe"></iframe>
          
      </nz-col>
      <nz-col nzSpan="10" class="container containerb">
        <div class="config-editor-container">
          <h3 class="config-title">
            <span nz-icon nzType="file-text" nzTheme="outline"></span> 配置文件
          </h3>
          <nz-alert *ngIf="configError" nzType="error" nzMessage="配置格式错误" [nzDescription]="configError" nzShowIcon></nz-alert>
          <nz-alert *ngIf="configSuccess" nzType="success" nzMessage="配置已更新" nzShowIcon></nz-alert>
          <div class="editor-wrapper">
            <textarea 
              nz-input 
              [(ngModel)]="configContent" 
              [nzAutosize]="{ minRows: 15, maxRows: 25 }"
              placeholder="加载配置文件中..."
              class="config-textarea"
              (ngModelChange)="validateConfig()"></textarea>
          </div>
          <div class="config-actions">
            <button nz-button nzType="default" (click)="resetConfig()">
              <span nz-icon nzType="reload" nzTheme="outline"></span> 重置
            </button>
            <button nz-button nzType="primary" (click)="submitConfig()" [disabled]="!!configError || isSubmitting">
              <span nz-icon [nzType]="isSubmitting ? 'loading' : 'save'" nzTheme="outline"></span> 提交配置
            </button>
          </div>
        </div>
      </nz-col>
    </nz-row>
  </nz-content>
</div>
