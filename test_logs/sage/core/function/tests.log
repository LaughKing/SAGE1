[1m============================= test session starts ==============================[0m
platform linux -- Python 3.11.10, pytest-7.4.4, pluggy-1.0.0 -- /opt/conda/envs/sage/bin/python
cachedir: .pytest_cache
rootdir: /home/tjy/SAGE
plugins: typeguard-4.3.0, mock-3.14.1, anyio-4.6.0
[1mcollecting ... [0mcollected 56 items

sage/core/function/tests/agent_tests/arxiv_paper_searcher_test.py::test_tool_initialization [32mPASSED[0m[32m [  1%][0m
sage/core/function/tests/agent_tests/arxiv_paper_searcher_test.py::test_execute_success_with_mock [32mPASSED[0m[32m [  3%][0m
sage/core/function/tests/agent_tests/arxiv_paper_searcher_test.py::test_execute_handles_network_error [32mPASSED[0m[32m [  5%][0m
sage/core/function/tests/agent_tests/arxiv_paper_searcher_test.py::test_execute_parameter_handling [32mPASSED[0m[32m [  7%][0m
sage/core/function/tests/agent_tests/arxiv_paper_searcher_test.py::test_execute_no_results_found [32mPASSED[0m[32m [  8%][0m
sage/core/function/tests/agent_tests/image_captioner_test.py::test_initialization [32mPASSED[0m[32m [ 10%][0m
sage/core/function/tests/agent_tests/image_captioner_test.py::test_execute_success [31mFAILED[0m[31m [ 12%][0m
sage/core/function/tests/agent_tests/image_captioner_test.py::test_execute_model_not_set [32mPASSED[0m[31m [ 14%][0m
sage/core/function/tests/agent_tests/image_captioner_test.py::test_execute_retry_on_connection_error [31mFAILED[0m[31m [ 16%][0m
sage/core/function/tests/agent_tests/image_captioner_test.py::test_execute_max_retries_exceeded [31mFAILED[0m[31m [ 17%][0m
sage/core/function/tests/agent_tests/image_captioner_test.py::test_execute_handles_general_exception [31mFAILED[0m[31m [ 19%][0m
sage/core/function/tests/agent_tests/nature_news_fetcher_test.py::test_initialization [32mPASSED[0m[31m [ 21%][0m
sage/core/function/tests/agent_tests/nature_news_fetcher_test.py::test_parse_articles [32mPASSED[0m[31m [ 23%][0m
sage/core/function/tests/agent_tests/nature_news_fetcher_test.py::test_execute_success_multiple_pages [32mPASSED[0m[31m [ 25%][0m
sage/core/function/tests/agent_tests/nature_news_fetcher_test.py::test_execute_stops_when_no_articles_found [32mPASSED[0m[31m [ 26%][0m
sage/core/function/tests/agent_tests/nature_news_fetcher_test.py::test_execute_handles_network_error [32mPASSED[0m[31m [ 28%][0m
sage/core/function/tests/agent_tests/nature_news_fetcher_test.py::test_execute_respects_num_articles_limit [32mPASSED[0m[31m [ 30%][0m
sage/core/function/tests/agent_tests/text_detector_test.py::test_initialization [32mPASSED[0m[31m [ 32%][0m
sage/core/function/tests/agent_tests/text_detector_test.py::test_execute_success_detail_1 [32mPASSED[0m[31m [ 33%][0m
sage/core/function/tests/agent_tests/text_detector_test.py::test_execute_success_detail_0 [32mPASSED[0m[31m [ 35%][0m
sage/core/function/tests/agent_tests/text_detector_test.py::test_build_tool_import_error [32mPASSED[0m[31m [ 37%][0m
sage/core/function/tests/agent_tests/text_detector_test.py::test_cuda_out_of_memory_with_retry_and_clear_cache [31mFAILED[0m[31m [ 39%][0m
sage/core/function/tests/agent_tests/text_detector_test.py::test_fails_after_max_retries [31mFAILED[0m[31m [ 41%][0m
sage/core/function/tests/agent_tests/url_text_extractor_test.py::test_initialization [32mPASSED[0m[31m [ 42%][0m
sage/core/function/tests/agent_tests/url_text_extractor_test.py::test_execute_success [32mPASSED[0m[31m [ 44%][0m
sage/core/function/tests/agent_tests/url_text_extractor_test.py::test_arxiv_pdf_url_replacement [32mPASSED[0m[31m [ 46%][0m
sage/core/function/tests/agent_tests/url_text_extractor_test.py::test_text_truncation [32mPASSED[0m[31m [ 48%][0m
sage/core/function/tests/agent_tests/url_text_extractor_test.py::test_network_error_handling [32mPASSED[0m[31m [ 50%][0m
sage/core/function/tests/agent_tests/url_text_extractor_test.py::test_general_error_handling [31mFAILED[0m[31m [ 51%][0m
sage/core/function/tests/io_tests/sink_test.py::test_terminal_sink [32mPASSED[0m[31m [ 53%][0m
sage/core/function/tests/io_tests/sink_test.py::test_retrive_sink [32mPASSED[0m[31m [ 55%][0m
sage/core/function/tests/io_tests/sink_test.py::test_file_sink_writes [32mPASSED[0m[31m [ 57%][0m
sage/core/function/tests/io_tests/sink_test.py::test_mem_write_sink_various_inputs [32mPASSED[0m[31m [ 58%][0m
sage/core/function/tests/io_tests/sink_test.py::test_mem_write_sink_handles_non_string [32mPASSED[0m[31m [ 60%][0m
sage/core/function/tests/io_tests/test_print_functionality.py::TestPrintSink::test_dictionary [32mPASSED[0m[31m [ 62%][0m
sage/core/function/tests/io_tests/test_print_functionality.py::TestPrintSink::test_other_types [32mPASSED[0m[31m [ 64%][0m
sage/core/function/tests/io_tests/test_print_functionality.py::TestPrintSink::test_prefix_and_separator [32mPASSED[0m[31m [ 66%][0m
sage/core/function/tests/io_tests/test_print_functionality.py::TestPrintSink::test_qa_tuple_colored [32mPASSED[0m[31m [ 67%][0m
sage/core/function/tests/io_tests/test_print_functionality.py::TestPrintSink::test_qa_tuple_no_color [32mPASSED[0m[31m [ 69%][0m
sage/core/function/tests/io_tests/test_print_functionality.py::TestPrintSink::test_retrieval_tuple [32mPASSED[0m[31m [ 71%][0m
sage/core/function/tests/io_tests/test_print_functionality.py::TestPrintSink::test_simple_string [32mPASSED[0m[31m [ 73%][0m
sage/core/function/tests/io_tests/test_print_functionality.py::TestPrintSink::test_string_list [32mPASSED[0m[31m [ 75%][0m
sage/core/function/tests/rag_tests/evaluate_test.py::test_f1_evaluate [32mPASSED[0m[31m [ 76%][0m
sage/core/function/tests/rag_tests/evaluate_test.py::test_bert_recall [31mFAILED[0m[31m [ 78%][0m
sage/core/function/tests/rag_tests/evaluate_test.py::test_rouge_l [31mFAILED[0m[31m [ 80%][0m
sage/core/function/tests/rag_tests/evaluate_test.py::test_brs [31mFAILED[0m[31m     [ 82%][0m
sage/core/function/tests/rag_tests/generator_test.py::test_openai_generator [31mFAILED[0m[31m [ 83%][0m
sage/core/function/tests/rag_tests/generator_test.py::test_openai_generator_history_state [31mFAILED[0m[31m [ 85%][0m
sage/core/function/tests/rag_tests/prompt_test.py::test_qapromptor_with_corpus [32mPASSED[0m[31m [ 87%][0m
sage/core/function/tests/rag_tests/prompt_test.py::test_qapromptor_without_corpus [32mPASSED[0m[31m [ 89%][0m
sage/core/function/tests/rag_tests/reranker_test.py::test_bge_reranker [32mPASSED[0m[31m [ 91%][0m
sage/core/function/tests/rag_tests/reranker_test.py::test_llm_reranker [32mPASSED[0m[31m [ 92%][0m
sage/core/function/tests/rag_tests/retriever_test.py::test_dense_retriever_execute [32mPASSED[0m[31m [ 94%][0m
sage/core/function/tests/rag_tests/retriever_test.py::test_dense_retriever_execute_no_ltm [32mPASSED[0m[31m [ 96%][0m
sage/core/function/tests/rag_tests/retriever_test.py::test_bm25s_retriever_execute [32mPASSED[0m[31m [ 98%][0m
sage/core/function/tests/rag_tests/retriever_test.py::test_bm25s_retriever_execute_no_collection [32mPASSED[0m[31m [100%][0m

=================================== FAILURES ===================================
[31m[1m_____________________________ test_execute_success _____________________________[0m
[1m[31msage/core/function/tests/agent_tests/image_captioner_test.py[0m:58: in test_execute_success
    mocker.patch([33m'[39;49;00m[33msage_libs.tools.image_captioner.OpenAIClient[39;49;00m[33m'[39;49;00m, return_value=mock_client_instance)[90m[39;49;00m
[1m[31m/opt/conda/envs/sage/lib/python3.11/site-packages/pytest_mock/plugin.py[0m:439: in __call__
    [94mreturn[39;49;00m [96mself[39;49;00m._start_patch([90m[39;49;00m
[1m[31m/opt/conda/envs/sage/lib/python3.11/site-packages/pytest_mock/plugin.py[0m:257: in _start_patch
    mocked: MockType = p.start()[90m[39;49;00m
[1m[31m/opt/conda/envs/sage/lib/python3.11/unittest/mock.py[0m:1594: in start
    result = [96mself[39;49;00m.[92m__enter__[39;49;00m()[90m[39;49;00m
[1m[31m/opt/conda/envs/sage/lib/python3.11/unittest/mock.py[0m:1430: in __enter__
    [96mself[39;49;00m.target = [96mself[39;49;00m.getter()[90m[39;49;00m
[1m[31m/opt/conda/envs/sage/lib/python3.11/pkgutil.py[0m:715: in resolve_name
    result = [96mgetattr[39;49;00m(result, p)[90m[39;49;00m
[1m[31mE   AttributeError: module 'sage_libs' has no attribute 'tools'[0m
---------------------------- Captured stdout setup -----------------------------
ImageCaptioner initialized with model: meta-llama/Llama-2-13b-chat-hf
[31m[1m____________________ test_execute_retry_on_connection_error ____________________[0m
[1m[31msage/core/function/tests/agent_tests/image_captioner_test.py[0m:101: in test_execute_retry_on_connection_error
    mocker.patch([33m'[39;49;00m[33msage_libs.tools.image_captioner.OpenAIClient[39;49;00m[33m'[39;49;00m, return_value=mock_client_instance)[90m[39;49;00m
[1m[31m/opt/conda/envs/sage/lib/python3.11/site-packages/pytest_mock/plugin.py[0m:439: in __call__
    [94mreturn[39;49;00m [96mself[39;49;00m._start_patch([90m[39;49;00m
[1m[31m/opt/conda/envs/sage/lib/python3.11/site-packages/pytest_mock/plugin.py[0m:257: in _start_patch
    mocked: MockType = p.start()[90m[39;49;00m
[1m[31m/opt/conda/envs/sage/lib/python3.11/unittest/mock.py[0m:1594: in start
    result = [96mself[39;49;00m.[92m__enter__[39;49;00m()[90m[39;49;00m
[1m[31m/opt/conda/envs/sage/lib/python3.11/unittest/mock.py[0m:1430: in __enter__
    [96mself[39;49;00m.target = [96mself[39;49;00m.getter()[90m[39;49;00m
[1m[31m/opt/conda/envs/sage/lib/python3.11/pkgutil.py[0m:715: in resolve_name
    result = [96mgetattr[39;49;00m(result, p)[90m[39;49;00m
[1m[31mE   AttributeError: module 'sage_libs' has no attribute 'tools'[0m
---------------------------- Captured stdout setup -----------------------------
ImageCaptioner initialized with model: meta-llama/Llama-2-13b-chat-hf
[31m[1m______________________ test_execute_max_retries_exceeded _______________________[0m
[1m[31msage/core/function/tests/agent_tests/image_captioner_test.py[0m:126: in test_execute_max_retries_exceeded
    mocker.patch([33m'[39;49;00m[33msage_libs.tools.image_captioner.OpenAIClient[39;49;00m[33m'[39;49;00m, return_value=mock_client_instance)[90m[39;49;00m
[1m[31m/opt/conda/envs/sage/lib/python3.11/site-packages/pytest_mock/plugin.py[0m:439: in __call__
    [94mreturn[39;49;00m [96mself[39;49;00m._start_patch([90m[39;49;00m
[1m[31m/opt/conda/envs/sage/lib/python3.11/site-packages/pytest_mock/plugin.py[0m:257: in _start_patch
    mocked: MockType = p.start()[90m[39;49;00m
[1m[31m/opt/conda/envs/sage/lib/python3.11/unittest/mock.py[0m:1594: in start
    result = [96mself[39;49;00m.[92m__enter__[39;49;00m()[90m[39;49;00m
[1m[31m/opt/conda/envs/sage/lib/python3.11/unittest/mock.py[0m:1430: in __enter__
    [96mself[39;49;00m.target = [96mself[39;49;00m.getter()[90m[39;49;00m
[1m[31m/opt/conda/envs/sage/lib/python3.11/pkgutil.py[0m:715: in resolve_name
    result = [96mgetattr[39;49;00m(result, p)[90m[39;49;00m
[1m[31mE   AttributeError: module 'sage_libs' has no attribute 'tools'[0m
---------------------------- Captured stdout setup -----------------------------
ImageCaptioner initialized with model: meta-llama/Llama-2-13b-chat-hf
[31m[1m____________________ test_execute_handles_general_exception ____________________[0m
[1m[31msage/core/function/tests/agent_tests/image_captioner_test.py[0m:150: in test_execute_handles_general_exception
    mocker.patch([33m'[39;49;00m[33msage_libs.tools.image_captioner.OpenAIClient[39;49;00m[33m'[39;49;00m, return_value=mock_client_instance)[90m[39;49;00m
[1m[31m/opt/conda/envs/sage/lib/python3.11/site-packages/pytest_mock/plugin.py[0m:439: in __call__
    [94mreturn[39;49;00m [96mself[39;49;00m._start_patch([90m[39;49;00m
[1m[31m/opt/conda/envs/sage/lib/python3.11/site-packages/pytest_mock/plugin.py[0m:257: in _start_patch
    mocked: MockType = p.start()[90m[39;49;00m
[1m[31m/opt/conda/envs/sage/lib/python3.11/unittest/mock.py[0m:1594: in start
    result = [96mself[39;49;00m.[92m__enter__[39;49;00m()[90m[39;49;00m
[1m[31m/opt/conda/envs/sage/lib/python3.11/unittest/mock.py[0m:1430: in __enter__
    [96mself[39;49;00m.target = [96mself[39;49;00m.getter()[90m[39;49;00m
[1m[31m/opt/conda/envs/sage/lib/python3.11/pkgutil.py[0m:715: in resolve_name
    result = [96mgetattr[39;49;00m(result, p)[90m[39;49;00m
[1m[31mE   AttributeError: module 'sage_libs' has no attribute 'tools'[0m
---------------------------- Captured stdout setup -----------------------------
ImageCaptioner initialized with model: meta-llama/Llama-2-13b-chat-hf
[31m[1m______________ test_cuda_out_of_memory_with_retry_and_clear_cache ______________[0m
[1m[31msage/core/function/tests/agent_tests/text_detector_test.py[0m:110: in test_cuda_out_of_memory_with_retry_and_clear_cache
    mock_torch = mocker.patch([33m'[39;49;00m[33msage_libs.tools.text_detector.torch[39;49;00m[33m'[39;49;00m)[90m[39;49;00m
[1m[31m/opt/conda/envs/sage/lib/python3.11/site-packages/pytest_mock/plugin.py[0m:439: in __call__
    [94mreturn[39;49;00m [96mself[39;49;00m._start_patch([90m[39;49;00m
[1m[31m/opt/conda/envs/sage/lib/python3.11/site-packages/pytest_mock/plugin.py[0m:257: in _start_patch
    mocked: MockType = p.start()[90m[39;49;00m
[1m[31m/opt/conda/envs/sage/lib/python3.11/unittest/mock.py[0m:1594: in start
    result = [96mself[39;49;00m.[92m__enter__[39;49;00m()[90m[39;49;00m
[1m[31m/opt/conda/envs/sage/lib/python3.11/unittest/mock.py[0m:1430: in __enter__
    [96mself[39;49;00m.target = [96mself[39;49;00m.getter()[90m[39;49;00m
[1m[31m/opt/conda/envs/sage/lib/python3.11/pkgutil.py[0m:715: in resolve_name
    result = [96mgetattr[39;49;00m(result, p)[90m[39;49;00m
[1m[31mE   AttributeError: module 'sage_libs' has no attribute 'tools'[0m
[31m[1m_________________________ test_fails_after_max_retries _________________________[0m
[1m[31msage/core/function/tests/agent_tests/text_detector_test.py[0m:139: in test_fails_after_max_retries
    mocker.patch([33m'[39;49;00m[33msage_libs.tools.text_detector.torch[39;49;00m[33m'[39;49;00m)[90m[39;49;00m
[1m[31m/opt/conda/envs/sage/lib/python3.11/site-packages/pytest_mock/plugin.py[0m:439: in __call__
    [94mreturn[39;49;00m [96mself[39;49;00m._start_patch([90m[39;49;00m
[1m[31m/opt/conda/envs/sage/lib/python3.11/site-packages/pytest_mock/plugin.py[0m:257: in _start_patch
    mocked: MockType = p.start()[90m[39;49;00m
[1m[31m/opt/conda/envs/sage/lib/python3.11/unittest/mock.py[0m:1594: in start
    result = [96mself[39;49;00m.[92m__enter__[39;49;00m()[90m[39;49;00m
[1m[31m/opt/conda/envs/sage/lib/python3.11/unittest/mock.py[0m:1430: in __enter__
    [96mself[39;49;00m.target = [96mself[39;49;00m.getter()[90m[39;49;00m
[1m[31m/opt/conda/envs/sage/lib/python3.11/pkgutil.py[0m:715: in resolve_name
    result = [96mgetattr[39;49;00m(result, p)[90m[39;49;00m
[1m[31mE   AttributeError: module 'sage_libs' has no attribute 'tools'[0m
[31m[1m_________________________ test_general_error_handling __________________________[0m
[1m[31msage/core/function/tests/agent_tests/url_text_extractor_test.py[0m:128: in test_general_error_handling
    mocker.patch([33m'[39;49;00m[33msage_libs.tools.url_text_extractor.BeautifulSoup[39;49;00m[33m'[39;49;00m, side_effect=[96mException[39;49;00m(error_message))[90m[39;49;00m
[1m[31m/opt/conda/envs/sage/lib/python3.11/site-packages/pytest_mock/plugin.py[0m:439: in __call__
    [94mreturn[39;49;00m [96mself[39;49;00m._start_patch([90m[39;49;00m
[1m[31m/opt/conda/envs/sage/lib/python3.11/site-packages/pytest_mock/plugin.py[0m:257: in _start_patch
    mocked: MockType = p.start()[90m[39;49;00m
[1m[31m/opt/conda/envs/sage/lib/python3.11/unittest/mock.py[0m:1594: in start
    result = [96mself[39;49;00m.[92m__enter__[39;49;00m()[90m[39;49;00m
[1m[31m/opt/conda/envs/sage/lib/python3.11/unittest/mock.py[0m:1430: in __enter__
    [96mself[39;49;00m.target = [96mself[39;49;00m.getter()[90m[39;49;00m
[1m[31m/opt/conda/envs/sage/lib/python3.11/pkgutil.py[0m:715: in resolve_name
    result = [96mgetattr[39;49;00m(result, p)[90m[39;49;00m
[1m[31mE   AttributeError: module 'sage_libs' has no attribute 'tools'[0m
[31m[1m_______________________________ test_bert_recall _______________________________[0m
[1m[31m/opt/conda/envs/sage/lib/python3.11/site-packages/urllib3/connection.py[0m:199: in _new_conn
    sock = connection.create_connection([90m[39;49;00m
[1m[31m/opt/conda/envs/sage/lib/python3.11/site-packages/urllib3/util/connection.py[0m:85: in create_connection
    [94mraise[39;49;00m err[90m[39;49;00m
[1m[31m/opt/conda/envs/sage/lib/python3.11/site-packages/urllib3/util/connection.py[0m:73: in create_connection
    sock.connect(sa)[90m[39;49;00m
[1m[31mE   OSError: [Errno 101] Network is unreachable[0m

[33mThe above exception was the direct cause of the following exception:[0m
[1m[31m/opt/conda/envs/sage/lib/python3.11/site-packages/urllib3/connectionpool.py[0m:789: in urlopen
    response = [96mself[39;49;00m._make_request([90m[39;49;00m
[1m[31m/opt/conda/envs/sage/lib/python3.11/site-packages/urllib3/connectionpool.py[0m:490: in _make_request
    [94mraise[39;49;00m new_e[90m[39;49;00m
[1m[31m/opt/conda/envs/sage/lib/python3.11/site-packages/urllib3/connectionpool.py[0m:466: in _make_request
    [96mself[39;49;00m._validate_conn(conn)[90m[39;49;00m
[1m[31m/opt/conda/envs/sage/lib/python3.11/site-packages/urllib3/connectionpool.py[0m:1095: in _validate_conn
    conn.connect()[90m[39;49;00m
[1m[31m/opt/conda/envs/sage/lib/python3.11/site-packages/urllib3/connection.py[0m:693: in connect
    [96mself[39;49;00m.sock = sock = [96mself[39;49;00m._new_conn()[90m[39;49;00m
[1m[31m/opt/conda/envs/sage/lib/python3.11/site-packages/urllib3/connection.py[0m:214: in _new_conn
    [94mraise[39;49;00m NewConnectionError([90m[39;49;00m
[1m[31mE   urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPSConnection object at 0x7f2c2d12bad0>: Failed to establish a new connection: [Errno 101] Network is unreachable[0m

[33mThe above exception was the direct cause of the following exception:[0m
[1m[31m/opt/conda/envs/sage/lib/python3.11/site-packages/requests/adapters.py[0m:667: in send
    resp = conn.urlopen([90m[39;49;00m
[1m[31m/opt/conda/envs/sage/lib/python3.11/site-packages/urllib3/connectionpool.py[0m:843: in urlopen
    retries = retries.increment([90m[39;49;00m
[1m[31m/opt/conda/envs/sage/lib/python3.11/site-packages/urllib3/util/retry.py[0m:519: in increment
    [94mraise[39;49;00m MaxRetryError(_pool, url, reason) [94mfrom[39;49;00m[90m [39;49;00m[04m[96mreason[39;49;00m  [90m# type: ignore[arg-type][39;49;00m[90m[39;49;00m
[1m[31mE   urllib3.exceptions.MaxRetryError: HTTPSConnectionPool(host='huggingface.co', port=443): Max retries exceeded with url: /bert-base-uncased/resolve/main/config.json (Caused by NewConnectionError('<urllib3.connection.HTTPSConnection object at 0x7f2c2d12bad0>: Failed to establish a new connection: [Errno 101] Network is unreachable'))[0m

[33mDuring handling of the above exception, another exception occurred:[0m
[1m[31m/opt/conda/envs/sage/lib/python3.11/site-packages/huggingface_hub/file_download.py[0m:1533: in _get_metadata_or_catch_error
    metadata = get_hf_file_metadata([90m[39;49;00m
[1m[31m/opt/conda/envs/sage/lib/python3.11/site-packages/huggingface_hub/utils/_validators.py[0m:114: in _inner_fn
    [94mreturn[39;49;00m fn(*args, **kwargs)[90m[39;49;00m
[1m[31m/opt/conda/envs/sage/lib/python3.11/site-packages/huggingface_hub/file_download.py[0m:1450: in get_hf_file_metadata
    r = _request_wrapper([90m[39;49;00m
[1m[31m/opt/conda/envs/sage/lib/python3.11/site-packages/huggingface_hub/file_download.py[0m:286: in _request_wrapper
    response = _request_wrapper([90m[39;49;00m
[1m[31m/opt/conda/envs/sage/lib/python3.11/site-packages/huggingface_hub/file_download.py[0m:309: in _request_wrapper
    response = http_backoff(method=method, url=url, **params, retry_on_exceptions=(), retry_on_status_codes=([94m429[39;49;00m,))[90m[39;49;00m
[1m[31m/opt/conda/envs/sage/lib/python3.11/site-packages/huggingface_hub/utils/_http.py[0m:310: in http_backoff
    response = session.request(method=method, url=url, **kwargs)[90m[39;49;00m
[1m[31m/opt/conda/envs/sage/lib/python3.11/site-packages/requests/sessions.py[0m:589: in request
    resp = [96mself[39;49;00m.send(prep, **send_kwargs)[90m[39;49;00m
[1m[31m/opt/conda/envs/sage/lib/python3.11/site-packages/requests/sessions.py[0m:703: in send
    r = adapter.send(request, **kwargs)[90m[39;49;00m
[1m[31m/opt/conda/envs/sage/lib/python3.11/site-packages/huggingface_hub/utils/_http.py[0m:96: in send
    [94mreturn[39;49;00m [96msuper[39;49;00m().send(request, *args, **kwargs)[90m[39;49;00m
[1m[31m/opt/conda/envs/sage/lib/python3.11/site-packages/requests/adapters.py[0m:700: in send
    [94mraise[39;49;00m [96mConnectionError[39;49;00m(e, request=request)[90m[39;49;00m
[1m[31mE   requests.exceptions.ConnectionError: (MaxRetryError("HTTPSConnectionPool(host='huggingface.co', port=443): Max retries exceeded with url: /bert-base-uncased/resolve/main/config.json (Caused by NewConnectionError('<urllib3.connection.HTTPSConnection object at 0x7f2c2d12bad0>: Failed to establish a new connection: [Errno 101] Network is unreachable'))"), '(Request ID: a693db43-718b-4ad7-9c8c-a89c0b253926)')[0m

[33mThe above exception was the direct cause of the following exception:[0m
[1m[31m/opt/conda/envs/sage/lib/python3.11/site-packages/transformers/utils/hub.py[0m:403: in cached_file
    resolved_file = hf_hub_download([90m[39;49;00m
[1m[31m/opt/conda/envs/sage/lib/python3.11/site-packages/huggingface_hub/utils/_validators.py[0m:114: in _inner_fn
    [94mreturn[39;49;00m fn(*args, **kwargs)[90m[39;49;00m
[1m[31m/opt/conda/envs/sage/lib/python3.11/site-packages/huggingface_hub/file_download.py[0m:1008: in hf_hub_download
    [94mreturn[39;49;00m _hf_hub_download_to_cache_dir([90m[39;49;00m
[1m[31m/opt/conda/envs/sage/lib/python3.11/site-packages/huggingface_hub/file_download.py[0m:1115: in _hf_hub_download_to_cache_dir
    _raise_on_head_call_error(head_call_error, force_download, local_files_only)[90m[39;49;00m
[1m[31m/opt/conda/envs/sage/lib/python3.11/site-packages/huggingface_hub/file_download.py[0m:1648: in _raise_on_head_call_error
    [94mraise[39;49;00m LocalEntryNotFoundError([90m[39;49;00m
[1m[31mE   huggingface_hub.errors.LocalEntryNotFoundError: An error happened while trying to locate the file on the Hub and we cannot find the requested files in the local cache. Please check your connection and try again or make sure your Internet connection is on.[0m

[33mThe above exception was the direct cause of the following exception:[0m
[1m[31msage/core/function/tests/rag_tests/evaluate_test.py[0m:24: in test_bert_recall
    evaluator = BertRecallEvaluate(config)[90m[39;49;00m
[1m[31msage/lib/rag/evaluate.py[0m:58: in __init__
    [96mself[39;49;00m.tokenizer = AutoTokenizer.from_pretrained([33m"[39;49;00m[33mbert-base-uncased[39;49;00m[33m"[39;49;00m)[90m[39;49;00m
[1m[31m/opt/conda/envs/sage/lib/python3.11/site-packages/transformers/models/auto/tokenization_auto.py[0m:864: in from_pretrained
    config = AutoConfig.from_pretrained([90m[39;49;00m
[1m[31m/opt/conda/envs/sage/lib/python3.11/site-packages/transformers/models/auto/configuration_auto.py[0m:1006: in from_pretrained
    config_dict, unused_kwargs = PretrainedConfig.get_config_dict(pretrained_model_name_or_path, **kwargs)[90m[39;49;00m
[1m[31m/opt/conda/envs/sage/lib/python3.11/site-packages/transformers/configuration_utils.py[0m:570: in get_config_dict
    config_dict, kwargs = [96mcls[39;49;00m._get_config_dict(pretrained_model_name_or_path, **kwargs)[90m[39;49;00m
[1m[31m/opt/conda/envs/sage/lib/python3.11/site-packages/transformers/configuration_utils.py[0m:629: in _get_config_dict
    resolved_config_file = cached_file([90m[39;49;00m
[1m[31m/opt/conda/envs/sage/lib/python3.11/site-packages/transformers/utils/hub.py[0m:446: in cached_file
    [94mraise[39;49;00m [96mEnvironmentError[39;49;00m([90m[39;49;00m
[1m[31mE   OSError: We couldn't connect to 'https://huggingface.co' to load this file, couldn't find it in the cached files and it looks like bert-base-uncased is not the path to a directory containing a file named config.json.[0m
[1m[31mE   Checkout your internet connection or see how to run the library in offline mode at 'https://huggingface.co/docs/transformers/installation#offline-mode'.[0m
[31m[1m_________________________________ test_rouge_l _________________________________[0m
[1m[31msage/core/function/tests/rag_tests/evaluate_test.py[0m:31: in test_rouge_l
    score = evaluator.rouge_l(test_data[[94m0[39;49;00m], test_data[[94m1[39;49;00m])[90m[39;49;00m
[1m[31mE   AttributeError: 'RougeLEvaluate' object has no attribute 'rouge_l'[0m
[31m[1m___________________________________ test_brs ___________________________________[0m
[1m[31msage/core/function/tests/rag_tests/evaluate_test.py[0m:37: in test_brs
    score = evaluator.BRS(test_data[[94m0[39;49;00m], test_data[[94m1[39;49;00m])[90m[39;49;00m
[1m[31mE   AttributeError: 'BRSEvaluate' object has no attribute 'BRS'[0m
[31m[1m____________________________ test_openai_generator _____________________________[0m
[1m[31msage/core/function/tests/rag_tests/generator_test.py[0m:48: in test_openai_generator
    gen = OpenAIGenerator(config_openai, [33m"[39;49;00m[33mlocal[39;49;00m[33m"[39;49;00m)[90m[39;49;00m
[1m[31mE   TypeError: OpenAIGenerator.__init__() takes 2 positional arguments but 3 were given[0m
[31m[1m_____________________ test_openai_generator_history_state ______________________[0m
[1m[31msage/core/function/tests/rag_tests/generator_test.py[0m:62: in test_openai_generator_history_state
    gen = OpenAIGeneratorWithHistory(config_openai, ctx = ctx)[90m[39;49;00m
[1m[31msage/lib/rag/generator.py[0m:74: in __init__
    [96msuper[39;49;00m().[92m__init__[39;49;00m(**kwargs)[90m[39;49;00m
[1m[31msage/core/function/base_function.py[0m:144: in __init__
    chkpt_dir = os.path.join([96mself[39;49;00m.ctx.env_base_dir, [33m"[39;49;00m[33m.sage_checkpoints[39;49;00m[33m"[39;49;00m)[90m[39;49;00m
[1m[31mE   AttributeError: 'NoneType' object has no attribute 'env_base_dir'[0m
[36m[1m=========================== short test summary info ============================[0m
[31mFAILED[0m sage/core/function/tests/agent_tests/image_captioner_test.py::[1mtest_execute_success[0m - AttributeError: module 'sage_libs' has no attribute 'tools'
[31mFAILED[0m sage/core/function/tests/agent_tests/image_captioner_test.py::[1mtest_execute_retry_on_connection_error[0m - AttributeError: module 'sage_libs' has no attribute 'tools'
[31mFAILED[0m sage/core/function/tests/agent_tests/image_captioner_test.py::[1mtest_execute_max_retries_exceeded[0m - AttributeError: module 'sage_libs' has no attribute 'tools'
[31mFAILED[0m sage/core/function/tests/agent_tests/image_captioner_test.py::[1mtest_execute_handles_general_exception[0m - AttributeError: module 'sage_libs' has no attribute 'tools'
[31mFAILED[0m sage/core/function/tests/agent_tests/text_detector_test.py::[1mtest_cuda_out_of_memory_with_retry_and_clear_cache[0m - AttributeError: module 'sage_libs' has no attribute 'tools'
[31mFAILED[0m sage/core/function/tests/agent_tests/text_detector_test.py::[1mtest_fails_after_max_retries[0m - AttributeError: module 'sage_libs' has no attribute 'tools'
[31mFAILED[0m sage/core/function/tests/agent_tests/url_text_extractor_test.py::[1mtest_general_error_handling[0m - AttributeError: module 'sage_libs' has no attribute 'tools'
[31mFAILED[0m sage/core/function/tests/rag_tests/evaluate_test.py::[1mtest_bert_recall[0m - OSError: We couldn't connect to 'https://huggingface.co' to load this file,...
[31mFAILED[0m sage/core/function/tests/rag_tests/evaluate_test.py::[1mtest_rouge_l[0m - AttributeError: 'RougeLEvaluate' object has no attribute 'rouge_l'
[31mFAILED[0m sage/core/function/tests/rag_tests/evaluate_test.py::[1mtest_brs[0m - AttributeError: 'BRSEvaluate' object has no attribute 'BRS'
[31mFAILED[0m sage/core/function/tests/rag_tests/generator_test.py::[1mtest_openai_generator[0m - TypeError: OpenAIGenerator.__init__() takes 2 positional arguments but 3 we...
[31mFAILED[0m sage/core/function/tests/rag_tests/generator_test.py::[1mtest_openai_generator_history_state[0m - AttributeError: 'NoneType' object has no attribute 'env_base_dir'
[31m======================== [31m[1m12 failed[0m, [32m44 passed[0m[31m in 26.47s[0m[31m ========================[0m
